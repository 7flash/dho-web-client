stages:  
  - build  
  - deploy

build_dev:  
  image: node:latest
  stage: build  
  only:
    - develop
  environment:
    name: dev
  variables:
    NETWORK_BLOCKCHAIN: '"eos"'
    NETWORK_CHAIN_ID: '"1eaa0824707c8c16bd25145493bf062aecddfeb56c736f6ba6397f3195f33c9f"'
    NETWORK_HOST: '"test.telos.kitchen"'
    NETWORK_PORT: '443'
    NETWORK_PROTOCOL: '"https"'
    TRX_WEB_PREFIX: '"https://telos-test.bloks.io/transaction/"'
    ACCT_WEB_PREFIX: '"https://telos-test.bloks.io/account/"'
    HYPHACONTRACT: '"hyphadaomain"'
    HYPHATOKENS: '"hyphatokens1"'
    HYPHA_SERVICES_URL: '"https://4qqy3aqt11.execute-api.us-east-1.amazonaws.com/dev"'
    HYPHA_SERVICES_API_KEY: $HYPHA_SERVICES_API_KEY_DEV
    WEBSERVICE: '"https://diadem.host/hypha"'
    STREAM_KEY: '"skkd3tdbsjfk"'
    STREAM_APP_ID: 55737
    STREAM_FEED_TOKEN_MEMBERS: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6Im1lbWJlcnNjb21tb24ifQ.SeQEGOdegqJ8aOaiHTITrpnoSyDEtl3m9Ye7iNL2I_c"'
    STREAM_FEED_TOKEN_PROPOSALS: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6InByb3Bvc2Fsc2NvbW1vbiJ9.ZyEuM0wlmq5yRJNQasqXK464Drbq7O4aKO9QlXjN8YE"'
    STREAM_FEED_TOKEN_ROLES: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6InJvbGVzY29tbW9uIn0.mm11GGj8rn_aLfO-bJ3ThoGSL5Cnr35IgBEtsvpXXQ8"'
  cache:
    paths:
      - node_modules/
  script:    
    # Install vuecli    
    - yarn global add @vue/cli@latest    
    # Install dependencies    
    - yarn install    
    # Build App    
    - yarn build  
  artifacts:    
    paths:      
      # Build folder      
      - dist/    
    expire_in: 1 hour

# build_prod:  
#   image: node:latest
#   stage: build  
#   only:
#     - master
#   environment:
#     name: production
#   variables:
  # variables:
  #   NETWORK_BLOCKCHAIN: '"eos"'
  #   NETWORK_CHAIN_ID: '"1eaa0824707c8c16bd25145493bf062aecddfeb56c736f6ba6397f3195f33c9f"'
  #   NETWORK_HOST: '"test.telos.kitchen"'
  #   NETWORK_PORT: '443'
  #   NETWORK_PROTOCOL: '"https"'
  #   TRX_WEB_PREFIX: '"https://telos-test.bloks.io/transaction/"'
  #   ACCT_WEB_PREFIX: '"https://telos-test.bloks.io/account/"'
  #   HYPHACONTRACT: '"hyphadaomain"'
  #   HYPHATOKENS: '"hyphatokens1"'
  #   HYPHA_SERVICES_URL: '"https://4qqy3aqt11.execute-api.us-east-1.amazonaws.com/dev"'
  #   HYPHA_SERVICES_API_KEY: $HYPHA_SERVICES_API_KEY_PROD
  #   WEBSERVICE: '"https://diadem.host/hypha"'
  #   STREAM_KEY: '"skkd3tdbsjfk"'
  #   STREAM_APP_ID: 55737
  #   STREAM_FEED_TOKEN_MEMBERS: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6Im1lbWJlcnNjb21tb24ifQ.SeQEGOdegqJ8aOaiHTITrpnoSyDEtl3m9Ye7iNL2I_c"'
  #   STREAM_FEED_TOKEN_PROPOSALS: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6InByb3Bvc2Fsc2NvbW1vbiJ9.ZyEuM0wlmq5yRJNQasqXK464Drbq7O4aKO9QlXjN8YE"'
  #   STREAM_FEED_TOKEN_ROLES: '"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZXNvdXJjZSI6IioiLCJhY3Rpb24iOiJyZWFkIiwiZmVlZF9pZCI6InJvbGVzY29tbW9uIn0.mm11GGj8rn_aLfO-bJ3ThoGSL5Cnr35IgBEtsvpXXQ8"'

#   cache:
#     paths:
#       - node_modules/
#   script:    
#     # Install vuecli    
#     - yarn global add @vue/cli@latest    
#     # Install dependencies    
#     - yarn install    
#     # Build App    
#     - yarn build  
#   artifacts:    
#     paths:      
#       # Build folder      
#       - dist/    
#     expire_in: 1 hour

deploy_dev:  
  image: python:latest  
  stage: deploy  
  only:    
    - develop  
  environment:
    name: dev
  script:    
    - echo $CI_ENVIRONMENT_NAME
    - pip install awscli    
    - aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID_DEV
    - aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY_DEV
    - aws s3 rm s3://hypha-dapp-test
    - aws s3 sync ./dist/spa s3://hypha-dapp-test
    # - aws configure set aws_access_key_id $INVALIDATOR_KEY_ID
    # - aws configure set aws_secret_access_key $INVALIDATOR_KEY
    # - aws cloudfront create-invalidation --distribution-id $AWS_DIST_ID_DEV --paths "/*"

# deploy_prod:  
#   image: python:latest  
#   stage: deploy  
#   only:    
#     - master  
#   environment:
#     name: production
#   script:    
#     - echo $CI_ENVIRONMENT_NAME
#     - pip install awscli    
#     - aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID_PROD
#     - aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY_PROD
#     - aws s3 rm s3://gyftie-mobile-prod
#     - aws s3 sync ./dist/spa s3://gyftie-mobile-prod
#     - aws configure set aws_access_key_id $INVALIDATOR_KEY_ID
#     - aws configure set aws_secret_access_key $INVALIDATOR_KEY
#     - aws cloudfront create-invalidation --distribution-id $AWS_DIST_ID_PROD --paths "/*"